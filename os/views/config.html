<!DOCTYPE html>
<html>

	<head lang="zh-CN">
		<meta http-equiv="X-UA-COMPATIBLE" content="IE=Edge">
		<meta charset="utf-8" />
		<title>配置</title>
		<meta name="viewport" contnet="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../resources/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../resources/css/bootstrap-theme.min.css" />
		<link rel="stylesheet" href="../resources/css/jquery.gritter.css" />
		<link rel="stylesheet" href="../resources/css/ui.jqgrid.css" />
		<link rel="stylesheet" href="../resources/css/font-awesome.min.css" />
		<link rel="stylesheet" href="../resources/css/datepicker.css" />
		<link rel="stylesheet" href="../resources/css/main-page.css" />
		<style>
			body,
			.page-container {
				height: 100%;
			}
			
			.content {
				height: 94%;
			}
			
			.panel-sel {
				margin: 10px 15px;
			}
			
			.panel-item {
				display: inline-block;
				color: #333;
				margin-right: 15px;
			}
			
			.panel-container {
				margin: 0 15px;
				padding: 15px 10px;
				border: 1px solid #ccc;
				border-radius: 10px;
				max-height: 94%;
				overflow-y: hidden;
			}
			
			.panel-container>div {
				max-height: 94%;
			}
			
			.panel-detail-head {
				padding-right: 100px;
				border-bottom: 1px solid #DDD;
				position: relative;
			}
			
			.btns-container {
				position: absolute;
				right: 15px;
				top: -13px;
			}
			
			.panel-detail-body {
				padding-right: 100px;
				max-height: 94%;
				overflow-y: auto;
			}
			
			table {
				width: 100%;
			}
			
			.border-bottom-td {
				border-bottom: 1px dashed #ccc;
			}
			
			.panel-detail-body tr td,
			.panel-detail-head tr td {
				padding: 10px;
			}
			
			.panel-detail-body tr.non-rowspaned td:first-child,
			.panel-detail-head tr td:first-child {
				width: 10%;
			}
			
			.panel-detail-body tr.non-rowspaned td:nth-child(2),
			.panel-detail-head tr td:nth-child(2) {
				width: 20%;
			}
			
			.panel-detail-body tr.non-rowspaned td:nth-child(3),
			.panel-detail-head tr td:nth-child(3) {
				width: 30%;
			}
			
			.panel-detail-body tr.non-rowspaned td:nth-child(4),
			.panel-detail-head tr td:nth-child(4) {
				width: 20%;
			}
			
			.panel-detail-body tr.non-rowspaned td:nth-child(5),
			.panel-detail-head tr td:nth-child(5) {
				width: 20%;
			}
			
			.panel-detail-body tr.rowspaned td:nth-child(1) {
				width: 20%;
			}
			
			.panel-detail-body tr.rowspaned td:nth-child(2) {
				width: 30%;
			}
			
			.panel-detail-body tr.rowspaned td:nth-child(3) {
				width: 20%;
			}
			
			.panel-detail-body tr.rowspaned td:nth-child(4) {
				width: 20%;
			}
			
			.set-expired-alert-container {
				display: inline-block;
				position: relative;
			}
			
			.set-expired-alert-container input {
				cursor: pointer;
			}
			
			.set-expired-alert-container img {
				margin-left: -20px;
			}
			
			.set-expired-alert-container label {
				width: 100%!important;
				display: inline-block;
				text-align: left;
				line-height: 20px;
				padding-left: 20px;
				cursor: pointer;
				margin: 0;
			}
			
			.set-expired-alert-container label:hover {
				background-color: #e3e3e3;
				color: #666;
			}
			.set-expired-alert-container label.active {
				background-color: #0099FF;
				color: #fff;
			}
			
			.sel-expired-alert-type {
				position: absolute;
				display: none;
				top: 30px;
				left: 0;
				width: 100%;
				border: 1px solid #ccc;
				border-radius: 5px;
				background-color: #fff;
				/*padding: 10px;*/
				/*text-align: center;*/
			}
			
			.sel-expired-alert-type label {
				display: block;
				width: 90%;
			}
			
			.width-fixed {
				display: inline-block;
				/*width: 50px;*/
			}
			
			.argu-set-module input {
				outline: none;
				border-radius: 5px;
			}
			
			.white-span {
				display: inline-block;
				/*width: 50px;*/
			}
			
			.operators:hover {
				text-decoration: none;
			}
			
			.operators .fa-2x {
				color: #ccc;
			}
		</style>
	</head>

	<body>
		<div class="page-container">
			<!--<div class="remark">
				<i class="fa fa-list-ol fa-2x"></i>
				<span>*系统参数配置</span>
			</div>-->
			<div class="content">
				<div class="panel-sel">
					<a href="javascript:;" index="0" class="panel-item active">版本参数</a>
					<a href="javascript:;" index="2" class="panel-item">模块设置</a>
				</div>
				<div class="panel-container">
					<!--审批设置-->
					<div class="module-set-panel" index="0">
						<div class="panel-detail-head">
							<table>
								<tbody>
									<tr>
										<td>配置项</td>
										<td>说明</td>
										<td>参数</td>
									</tr>
								</tbody>
							</table>
							<div class="btns-container">
								<a href="javascript:;" class="btn btn-sm btn-default btn-edit" onclick="letPanelBodyCanEdit(this)">编辑</a>
								<a href="javascript:;" class="btn btn-sm btn-default btn-submit hide" onclick="saveChange(this)">保存</a>
								<a href="javascript:;" class="btn btn-sm btn-default btn-cancel hide" onclick="cancelChange(this)">取消</a>
							</div>
						</div>
						<div class="panel-detail-body">
							<table>
								<tbody>
									<tr class="non-rowspaned">
										<td class="border-bottom-td" rowspan="1">试用版可试用时长</td>
										<td class="border-bottom-td">企业购买试用版后可试用时长</td>
										<td class="border-bottom-td">
											<span class="white-span"></span>
											<span class="static"></span>
											<input type="text" data-min-val="1" class="can-change hide" />
											<span>天</span>
										</td>
									</tr>
									<tr class="non-rowspaned">
										<td class="border-bottom-td" rowspan="1">试用版可试用人数</td>
										<td class="border-bottom-td">企业购买试用版后最大可开通人数</td>
										<td class="border-bottom-td">
											<span class="white-span"></span>
											<span class="static"></span>
											<input type="text" data-min-val="1" class="can-change hide">
											<span>人</span>
										</td>
									</tr>
									<tr class="non-rowspaned">
										<td class="border-bottom-td" rowspan="1">版本到期提醒方式</td>
										<td class="border-bottom-td">系统自动提醒企业版本到期的方式(邮件、短信提醒即通知企业管理员;系统消息即通知企业可联系客服的人员)</td>
										<td class="border-bottom-td">
											<span class="white-span"></span>
											<span class="static"></span>
											<div class="set-expired-alert-container can-change">
												<input style="cursor: pointer;" type="text" />
												<img style='margin-left: -20px;' src="../resources/images/select-angle-icon.png" alt="" />
												<div class="sel-expired-alert-type">
													<!--<select  multiple="multiple" >
														<option value="1">系统</option>
														<option value="2">邮件</option>
														<option value="3">短信</option>
													</select>-->
													<label data-val="1">
														<!--<input type="checkbox" value="1"/>-->
														<span>系统</span>
													</label>
													<label data-val="2">
														<!--<input type="checkbox" value="2"/>-->
														<span>邮件</span>
													</label>
													<label data-val="3">
														<!--<input type="checkbox" value="3"/>-->
														<span>短信</span>
													</label>
												</div>
											</div>
											<span>提醒</span>
										</td>
									</tr>
									<tr class="non-rowspaned">
										<td class="border-bottom-td" rowspan="9">版本到期提醒时间</td>
										<td class="border-bottom-td">企业版本到期提醒时间</td>
										<td class="border-bottom-td">
											<span class="white-span">到期前</span>
											<span class="static"></span>
											<input type="text" data-min-val="1" class="can-change hide" />
											<span>天</span>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<!--参数设置-->
					<div class="module-set-panel argu-set-module hide" index="2">
						<div class="panel-detail-head">
							<table>
								<tbody>
									<tr>
										<td>模版名称</td>
										<td>内容</td>
									</tr>
								</tbody>
							</table>
							<div class="btns-container">
								<a href="javascript:;" class="btn btn-sm btn-default btn-edit" onclick="letPanelBodyCanEdit(this);">编辑</a>
								<a href="javascript:;" class="btn btn-sm btn-default btn-submit hide" onclick="saveChange(this);">保存</a>
								<a href="javascript:;" class="btn btn-sm btn-default btn-cancel hide" onclick="cancelChange(this);">取消</a>
							</div>
						</div>
						<div class="panel-detail-body">
							<table>
								<tbody>
									<tr class="non-rowspaned">
										<td class="border-bottom-td" rowspan="1">企业版本到期提醒模版</td>
										<td class="border-bottom-td">
											<div class="static">
												<div class="system">
													<span>系统：</span>
													<div class="model-container">
														<label>一、</label>
														<span></span>
													</div>
												</div>
												<div class="email">
													<span>邮件：</span>
													<div class="model-container">
														<label>一、</label>
														<span></span>
													</div>
												</div>
												<div class="short-message">
													<span>短信：</span>
													<div class="model-container">
														<label>一、</label>
														<span></span>
													</div>
												</div>
											</div>
											<div class="can-change hide">
												<div class="system">
													<span>系统：</span>
													<div class="model-container">
														<label>一、</label>
														<textarea name="" rows="1" cols="30"></textarea>
														<a href="javascript:;" class="operators">
															<i class="fa fa-plus fa-2x add-new-row" onclick="addNewRow(this)"></i>
															<i class="fa fa-close fa-2x delet-row" onclick="deleteRow(this)"></i>
														</a>
													</div>
												</div>
												<div class="email">
													<span>邮件：</span>
													<div class="model-container">
														<label>一、</label>
														<label>标题：<input type="text" class="email-title"></label>
														<label>内容：<textarea style="vertical-align:middle;" name="" rows="1" cols="30"></textarea></label>
														<a href="javascript:;" class="operators">
															<i class="fa fa-plus fa-2x add-new-row" onclick="addNewRow(this)"></i>
															<i class="fa fa-close fa-2x delet-row" onclick="deleteRow(this)"></i>
														</a>
													</div>
												</div>
												<div class="short-message">
													<span>短信：</span>
													<div class="model-container">
														<label>一、</label>
														<textarea name="" rows="1" cols="30"></textarea>
														<a href="javascript:;" class="operators">
															<i class="fa fa-plus fa-2x add-new-row" onclick="addNewRow(this)"></i>
															<i class="fa fa-close fa-2x delet-row" onclick="deleteRow(this)"></i>
														</a>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tr class="non-rowspaned">
										<td class="border-bottom-td" rowspan="1">客服沟通快捷回复模版</td>
										<td class="border-bottom-td">
											<div class="static">
												<div class="email">
													<div class="model-container">
														<label>一、</label>
														<span></span>
													</div>
												</div>
											</div>
											<div class="can-change hide">
												<div class="email">
													<div class="model-container">
														<label>一、</label>
														<textarea name="" rows="1" cols="30"></textarea>
														<a href="javascript:;" class="operators">
															<i class="fa fa-plus fa-2x add-new-row" onclick="addNewRow(this)"></i>
															<i class="fa fa-close fa-2x delet-row" onclick="deleteRow(this)"></i>
														</a>
													</div>
												</div>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../resources/js/jquery.min.js"></script>
		<script type="text/javascript" src="../resources/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="../resources/js/jquery.gritter.min.js"></script>
		<script type="text/javascript" src="../resources/js/jquery.jqGrid.min.js"></script>
		<script type="text/javascript" src="../resources/js/grid.locale-zh.js"></script>
		<script type="text/javascript" src="../resources/upload/plupload.full.min.js"></script>
		<script type="text/javascript" src="../resources/js/sortable.js"></script>
		<script type="text/javascript" src="../resources/js/bootstrap-treeview.js"></script>
		<script type="text/javascript" src="../resources/js/bootstrap-datepicker.min.js"></script>
		<script type="text/javascript" src="../resources/js/main.min.js"></script>
		<script type="text/javascript">
			/*
			 
			 * 审批配置
			 * 
			 * 
			 * */
			//模块ID
			var MODULE=[
				{
					module_id: 1,//版本参数
					sub_module_group_item_ids: [
						1,//试用版可用时长
						2,//试用版可用人数
						3,//版本带起提醒方式
						4//版本到期提醒时间
					]
				},{
					module_id: 5,//模板设置
					sub_module_group_item_ids: [
						200,//企业版本到期提醒模板 
						201//客服沟通快捷回复模板
					]
				}
			];
			var ALL_MODULE={
				edition_module: {//版本参数
					edition_module_id:1,
					use_time_limit:1,
					use_person_limit:2,
					expire_alert_type: 3,
					expire_alert_time:4
				},
				argu_module:{//模板设置
					argu_module_id:5,
					expire_alert_model:200,
					customer_respone_model: 201
				}
				
			}
			var EXPIRE_ALERT_TYPE={
				system: 1,//系统
				email: 3,//邮件
				short_msg:2,//短信
			};
			$(".panel-container").css("height",$(window).height()-135+"px");
			$(".panel-container>div").css("height",$(".panel-container").outerHeight(true)+"px");
			$(".panel-container>div .panel-detail-body").css("height",$(".panel-container").outerHeight(true)-50+"px");
			//添加一行
			var addNewRow=function (obj){
				var modelContainer=$(obj).parent().parent();
				$(obj).parent().parent().after(modelContainer.clone(true));
				$(obj).parent().parent().next().find("textarea").val("");
				reSortRow($(obj).parent().parent().parent());
			}
			//删除一行
			var deleteRow=function (obj){
				if($(obj).parent().parent().parent().find(".model-container").length<2) {
					$.showErrorGritter("亲，不能再删了哦！");
					return false;
				}
				var rowContainer=$(obj).parent().parent().parent();
				$(obj).parents(".model-container").remove();
				reSortRow(rowContainer);
			}
			//每添加或删除一行之后重新计算每一个前面的标记
			function reSortRow(rowContainer){
				rowContainer.find(".model-container").each(function(i){
					$(this).find("label").text($.transNumberToChinese(parseInt(i+1))+"、");
				});
			}
			var configData;
			for(var i in MODULE) {
				$(".panel-container .module-set-panel:eq('"+i+"')").addClass("module-"+MODULE[i].module_id).attr("index",MODULE[i].module_id);
				$(".panel-sel .panel-item:eq('"+i+"')").addClass("module-"+MODULE[i].module_id).attr("index",MODULE[i].module_id);
				$(".panel-container .module-set-panel:eq('"+i+"') .btn").attr("index",MODULE[i].module_id);
				for(var n in MODULE[i].sub_module_group_item_ids) {
					$(".panel-container .module-set-panel:eq('"+i+"') .panel-detail-body tbody tr:eq('"+n+"')").addClass("module-item-"+MODULE[i].sub_module_group_item_ids[n]).data("config_type",MODULE[i].sub_module_group_item_ids[n]).attr("index",MODULE[i].sub_module_group_item_ids[n]);
				}
			}
			$(".panel-item").click(function(e){
				var index=$(this).attr("index");
				$(".panel-item").removeClass("active");
				$(this).addClass("active");
				$(".module-set-panel").addClass("hide");
				$(".module-set-panel[index='"+index+"']").removeClass("hide");
				cancelChange("",index);
				onConfigDataGeted(index,configData[index]);
			});
			$("input[data-min-val]").blur(function(){
				var inputVal=parseInt($(this).val());
				if(inputVal<parseInt($(this).attr("data-min-val"))||isNaN(inputVal)) {
					$.showErrorGritter("当前值必须为大于"+$(this).attr("data-min-val")+"的数字，请重新输入");
					$(this).focus();
				}
			});
			//让某一个panel处于可编辑状态
			function letPanelBodyCanEdit(obj) {
				//按钮切换
				var index= $(obj).attr("index");
				$(".module-set-panel[index='" + index + "'] .btn-edit").addClass("hide");
				$(".module-set-panel[index='" + index + "'] .btn-submit").removeClass("hide");
				$(".module-set-panel[index='" + index + "'] .btn-cancel").removeClass("hide");
				//面板状态切换
				$(".module-set-panel[index='" + index + "'] td .static").addClass("hide");
				$(".module-set-panel[index='" + index + "'] td .can-change").removeClass("hide");
			}
			//保存
			function saveChange(obj) {
				var index= $(obj).attr("index");
				if(index==ALL_MODULE.edition_module.edition_module_id){
					saveApvSetData(index);
				}else if(index==ALL_MODULE.argu_module.argu_module_id){
					saveArguSetData(index);
				}
			}
			//保存版本参数数据
			function saveApvSetData(index){
				var configArr=[];
				$(".module-set-panel[index='" + index + "'] .panel-detail-body tr").each(function(){
					var oneConfigData={};
					oneConfigData.config_id=$(this).data("config_id")||"";
					oneConfigData.config_type=$(this).data("config_type")||"";
					if($(this).hasClass("non-rowspaned")){
						if($(this).find("td:eq(2) input").attr("code")){
							oneConfigData.config_value=$(this).find("td:eq(2) input").attr("code");
						}else{
							oneConfigData.config_value=$(this).find("td:eq(2) input").val();
						}
					}else{
						oneConfigData.config_value=$(this).find("td:eq(1) input").val();
					}
					
					configArr.push(oneConfigData);
				});
				$.ajaxPost(OSAPIURL+"/config",{datas:configArr},function(resp){
					if(resp.code==0) {
						$.showSuccessGritter("保存成功！");
						//按钮切换
						$(".module-set-panel[index='" + index + "'] .btn-edit").removeClass("hide");
						$(".module-set-panel[index='" + index + "'] .btn-submit").addClass("hide");
						$(".module-set-panel[index='" + index + "'] .btn-cancel").addClass("hide");
						//面板状态切换
						$(".module-set-panel[index='" + index + "'] td .static").removeClass("hide");
						$(".module-set-panel[index='" + index + "'] td .can-change").addClass("hide");
						getConfigData(index);
					}else{
						$.showErrorGritter("保存失败："+resp.msg);
					}
				});
			}
			//取消
			function cancelChange(obj,index) {
				if(obj) var index= $(obj).attr("index");
				//按钮切换
				$(".module-set-panel[index='" + index + "'] .btn-edit").removeClass("hide");
				$(".module-set-panel[index='" + index + "'] .btn-submit").addClass("hide");
				$(".module-set-panel[index='" + index + "'] .btn-cancel").addClass("hide");
				//面板状态切换
				$(".module-set-panel[index='" + index + "'] td .static").removeClass("hide");
				$(".module-set-panel[index='" + index + "'] td .can-change").addClass("hide");
			}
			//获取数据
			function getConfigData(activeModuleId){
				$.ajaxGet(OSAPIURL+"/config",function(resp){
					if(resp.code!=0) {
						$.showErrorGritter("获取配置信息失败："+resp.msg);
						return false;
					}
					configData=resp.data;
					if(!activeModuleId) activeModuleId=$(".panel-item.active").attr("index");
					$(".panel-item.module-"+activeModuleId).click();
					onConfigDataGeted(activeModuleId,resp.data[activeModuleId]);
					$("option").unbind("click").click(function(){
						$(this).prop("selected","selected").siblings().removeProp("selected");
					});
				});
			}
			getConfigData();
			//获取到config数据
			function onConfigDataGeted(activeModuleId,data) {
				if(!data||data.length<1) return;
				if(activeModuleId==ALL_MODULE.edition_module.edition_module_id) {
					bindApvModuleDataOnHtml(data);
				}
				if(activeModuleId==ALL_MODULE.argu_module.argu_module_id) {
					bindArguModuleDataOnHtml(data);
				}
			}
			//绑定审批配置数据
			function bindApvModuleDataOnHtml(data){
				for(var i=0,len=data.length;i<len;i++) {
					var itemContainer=$(".module-item-"+data[i].config_type);
					itemContainer.data("cong_id",data[i].config_id);
					itemContainer.data("config_type",data[i].config_type);
					if(itemContainer.hasClass("non-rowspaned")){
						if(data[i].config_type==ALL_MODULE.edition_module.expire_alert_type){
							var alertCnArr=[];
							data[i].config_value.indexOf("1")>=0&&alertCnArr.push("系统");
							data[i].config_value.indexOf("2")>=0&&alertCnArr.push("邮件");
							data[i].config_value.indexOf("3")>=0&&alertCnArr.push("短信");
							itemContainer.find("td:eq(2) .static").text(alertCnArr.join(","));
							itemContainer.find("td:eq(2) .can-change>input").attr("code",data[i].config_value).val(alertCnArr.join(","));
							var alertTypeArr=(data[i].config_value).split(",");
							for(var t in alertTypeArr) {
								itemContainer.find("td:eq(2) .can-change .sel-expired-alert-type label[data-val='"+alertTypeArr[t]+"']").addClass("active");
							}
						}else {
							itemContainer.find("td:eq(2) .static").text(data[i].config_value);
							itemContainer.find("td:eq(2) .can-change").val(data[i].config_value);
						}
					}else{
						itemContainer.find("td:eq(1) .static").text(data[i].config_value);
						itemContainer.find("td:eq(1) .can-change").val(data[i].config_value);
					}
					
				}
			}
			/*
			 
			 * 参数配置
			 * 
			 * 
			 * */
			$(".set-expired-alert-container input[type='text']").click(function(){
				$(this).parent().find(">div").slideDown();
			});
			$(".set-expired-alert-container>div label").click(function(){
				$(this).toggleClass("active");
				onSetBirthdayLabelClick();
			});
			function onSetBirthdayLabelClick(){
				var allSelCodeType="",allSelText="";
				$(".set-expired-alert-container>div label").each(function(){
					if($(this).hasClass("active")){
						allSelText+=(!allSelText?"":",")+$(this).find("span").text();
						allSelCodeType+=(!allSelCodeType?"":",")+$(this).attr("data-val");
					}
				});
				var canChangeInputSelector=$(".set-expired-alert-container input[type='text']");
				canChangeInputSelector.attr("code",allSelCodeType);
				canChangeInputSelector.val(allSelText);
			}
			$("body").click(function(e){
				if($(event.target).parents(".set-expired-alert-container").length < 1) {
					$(".set-expired-alert-container>div").slideUp();
				}
			})
			//绑定参数配置数据
			function bindArguModuleDataOnHtml(data){
				for(var i=0,len=data.length;i<len;i++) {
					var itemContainer=$(".module-item-"+data[i].config_type);
					itemContainer.data("config_id",data[i].config_id);
					itemContainer.data("config_type",data[i].config_type);
					if(data[i].config_type==ALL_MODULE.argu_module.expire_alert_model) {
						var systemTextArr=data[i].config_value?JSON.parse(data[i].config_value):[],
						emailTextArr=data[i].config_value1?JSON.parse(data[i].config_value1):[],
						msgTextArr=data[i].config_value2?JSON.parse(data[i].config_value2):[];
						var strSystem="",strSystemCanChange="";
						itemContainer.find("td:eq(1) .static .email .model-container").remove();
						itemContainer.find("td:eq(1) .static .short-message .model-container").remove();
						itemContainer.find("td:eq(1) .static .system .model-container").remove();
						itemContainer.find("td:eq(1) .can-change .email .model-container").remove();
						itemContainer.find("td:eq(1) .can-change .short-message .model-container").remove();
						itemContainer.find("td:eq(1) .can-change .system .model-container").remove();
						systemTextArr=systemTextArr.length<1?systemTextArr[""]:systemTextArr;
						for(var n in systemTextArr) {
							strSystem+=
							"<div class=\"model-container\">"
							+"	<label>"+$.transNumberToChinese(parseInt(n)+1)+"、</label>"
							+"	<span>"+systemTextArr[n]+"</span>"
							+"</div>";
							strSystemCanChange+=
							"<div class=\"model-container\">"
							+"	<label>"+$.transNumberToChinese(parseInt(n)+1)+"、</label>"
							+"	<textarea name=\"\" rows=\"1\" cols=\"30\">"+systemTextArr[n]+"</textarea>"
//							+"	<a href=\"javascript:;\" class=\"operators\">"
//							+"		<i class=\"fa fa-plus fa-2x add-new-row\" onclick=\"addNewRow(this)\"></i>"
//							+"		<i class=\"fa fa-close fa-2x delet-row\" onclick=\"deleteRow(this)\"></i>"
//							+"	</a>"
							+"</div>";
						}
						itemContainer.find("td:eq(1) .static .system").append(strSystem);
						itemContainer.find("td:eq(1) .can-change .system").append(strSystemCanChange);
						var strEmail="",strEmailCanChange="";
						emailTextArr=emailTextArr.length<1?[""]:emailTextArr;
						for(var n in emailTextArr) {
							strEmail+=
							"<div class=\"model-container\">"
							+"	<label>"+$.transNumberToChinese(parseInt(n)+1)+"、</label>"
							+"	<span>标题："+emailTextArr[n].subject+"</span>   <span>内容："+emailTextArr[n].body+"</span>"
							+"</div>";
							strEmailCanChange+=
							"<div class=\"model-container\">"
							+"	<label>"+$.transNumberToChinese(parseInt(n)+1)+"、</label>"
							+"<label>标题：<input type=\"text\" class=\"email-title\" value=\""+emailTextArr[n].subject+"\"></label>"
							+"	<label>内容：<textarea  style=\"vertical-align: middle;\"name=\"\" rows=\"1\" cols=\"30\">"+emailTextArr[n].body+"</textarea></label>"
//							+"	<a href=\"javascript:;\" class=\"operators\">"
//							+"		<i class=\"fa fa-plus fa-2x add-new-row\" onclick=\"addNewRow(this)\"></i>"
//							+"		<i class=\"fa fa-close fa-2x delet-row\" onclick=\"deleteRow(this)\"></i>"
//							+"	</a>"
							+"</div>";
						}
						itemContainer.find("td:eq(1) .static .email").append(strEmail);
						itemContainer.find("td:eq(1) .can-change .email").append(strEmailCanChange);
						var strMsg="",strMsgCanChange="";
						msgTextArr=msgTextArr.length<1?[""]:msgTextArr;
						for(var n in msgTextArr) {
							strMsg+=
							"<div class=\"model-container\">"
							+"	<label>"+$.transNumberToChinese(parseInt(n)+1)+"、</label>"
							+"	<span>"+msgTextArr[n]+"</span>"
							+"</div>";
							strMsgCanChange+=
							"<div class=\"model-container\">"
							+"	<label>"+$.transNumberToChinese(parseInt(n)+1)+"、</label>"
							+"	<textarea name=\"\" rows=\"1\" cols=\"30\">"+msgTextArr[n]+"</textarea>"
//							+"	<a href=\"javascript:;\" class=\"operators\">"
//							+"		<i class=\"fa fa-plus fa-2x add-new-row\" onclick=\"addNewRow(this)\"></i>"
//							+"		<i class=\"fa fa-close fa-2x delet-row\" onclick=\"deleteRow(this)\"></i>"
//							+"	</a>"
							+"</div>";
						}
						itemContainer.find("td:eq(1) .static .short-message").append(strMsg);
						itemContainer.find("td:eq(1) .can-change .short-message").append(strMsgCanChange);
						//itemContainer.find("td:eq(1) .static .email span").text(data[i].config_value);
						//itemContainer.find("td:eq(1) .static .short-message span").text(data[i].config_value1);
						//letSeledBirthdayAlertChecked(itemContainer.find("td:eq(3) .can-change .sel-expired-alert-type"),data[i].config_value);
					}else{
						var modelArr=JSON.parse(data[i].config_value);
						itemContainer.find("td:eq(1) .static .email").html("");
						itemContainer.find("td:eq(1) .can-change .email").html("");
						var str="",strCanChange="";
						for(var n in modelArr) {
							str+=
							"<div class=\"model-container\">"
							+"	<label>"+$.transNumberToChinese(parseInt(n)+1)+"、</label>"
							+"	<span>"+modelArr[n]+"</span>"
							+"</div>";
							strCanChange+=
							"<div class=\"model-container\">"
							+"	<label>"+$.transNumberToChinese(parseInt(n)+1)+"、</label>"
							+"	<textarea name=\"\" rows=\"1\" cols=\"30\">"+modelArr[n]+"</textarea>"
							+"	<a href=\"javascript:;\" class=\"operators\">"
							+"		<i class=\"fa fa-plus fa-2x add-new-row\" onclick=\"addNewRow(this)\"></i>"
							+"		<i class=\"fa fa-close fa-2x delet-row\" onclick=\"deleteRow(this)\"></i>"
							+"	</a>"
							+"</div>";
						}
						itemContainer.find("td:eq(1) .static .email").append(str);
						itemContainer.find("td:eq(1) .can-change .email").append(strCanChange);
					}
				}
			}
			//保存参数设置数据
			function saveArguSetData(index){
				var configArr=[];
				$(".module-set-panel[index='" + index + "'] .panel-detail-body tr").each(function(){
					var oneConfigData={};
					oneConfigData.config_id=$(this).data("config_id")||"";
					oneConfigData.config_type=$(this).data("config_type")||"";
					if(oneConfigData.config_type==ALL_MODULE.argu_module.expire_alert_model) {
						$(this).find(".can-change>div").each(function(){
							if($(this).hasClass("system")) {
								var systemModel=[];
								$(this).find(".model-container").each(function(){
									if($(this).find("textarea").val()) systemModel.push($(this).find("textarea").val());
								});
								oneConfigData.config_value=JSON.stringify(systemModel);
							}else if($(this).hasClass("email")) {
								var emailModel=[];
								$(this).find(".model-container").each(function(){
									if($(this).find("textarea").val()) emailModel.push({"subject":$(this).find(".email-title").val(),"body":$(this).find("textarea").val()});
								});
								oneConfigData.config_value1=JSON.stringify(emailModel);
							}else {
								var msgModel=[];
								$(this).find(".model-container").each(function(){
									if($(this).find("textarea").val()) msgModel.push($(this).find("textarea").val());
								});
								console.log(msgModel)
								oneConfigData.config_value2=JSON.stringify(msgModel);
								//oneConfigData.config_value1=$(this).find("textarea").val();
							}
						});
					}else{
						if($(this).hasClass("non-rowspaned")){
							var modelArr=[];
							$(this).find(".model-container").each(function(){
								if($(this).find("textarea").val()) modelArr.push($(this).find("textarea").val());
							});
							oneConfigData.config_value=JSON.stringify(modelArr);
						}else{
							oneConfigData.config_value=$(this).find("td:eq(2) input[type='text']").val();
						}
					}
					
					configArr.push(oneConfigData);
				});
				$.ajaxPost(OSAPIURL+"/config",{datas:configArr},function(resp){
					if(resp.code==0) {
						$.showSuccessGritter("保存成功！");
						//按钮切换
						$(".module-set-panel[index='" + index + "'] .btn-edit").removeClass("hide");
						$(".module-set-panel[index='" + index + "'] .btn-submit").addClass("hide");
						$(".module-set-panel[index='" + index + "'] .btn-cancel").addClass("hide");
						//面板状态切换
						$(".module-set-panel[index='" + index + "'] td .static").removeClass("hide");
						$(".module-set-panel[index='" + index + "'] td .can-change").addClass("hide");
						getConfigData(index);
					}else{
						$.showErrorGritter("保存失败："+resp.msg);
					}
				});
			}
		</script>
	</body>
</html>